{% extends 'charts/base.html' %}
{% load i18n %}
{% block header %}
<title>{% trans "Revuo Moneroj - Metcalfe's Law (BTC)" %}</title>
{% endblock %}

{% block content %}

<!-- Content Wrapper -->
<div id="content-wrapper" style="background-color:rgb(48, 44, 41)">

    <!-- Content Row -->
    <div class="row" style="height: 92%; margin: 10px 10px 10px 10px;">
        <div class="card" id="graph1" style="width: 100%; height: 100%;">
            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between text-white">
                <h6 class="m-0 text-light">
                    {% trans "Metcalfe's Law (BTC)" %}
                </h6>
                
                <div class="dropdown no-arrow">
                    <a data-toggle="modal" href="#" class="link_graph" data-target="#id_Modal">
                        {% trans "About this chart?" %}
                    </a>
                    <a class="dropdown-toggle" href="#" role="button"
                        onclick="$('#graph1').toggleClass('fullscreen');window.dispatchEvent(new Event('resize'));">
                        <i class="bx bx-expand text-gray-400"></i>
                    </a>
                </div>
            </div>
            <div class="card-body"  style="width: 100%; height: 100%; margin: 0px 0px 0px 0px; padding: 0px 0px 0px 0px;">
                <div id="graph"  style="width: 100%; height: 100%;  margin: 0px 0px 0px 0px; padding: 0px 0px 0px 0px;"></div>
            </div>
        </div>
    </div>

</div>
<!-- End of Content Wrapper -->

<!-- Modal -->
<div class="modal fade" id="id_Modal" tabindex="-1" role="dialog" aria-labelledby="Modal" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="Modal">{% trans "Help about the chart" %}</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="{% trans 'Cancel' %}">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                {% blocktrans %}
                This chart shows the Monero's supposed fair price, judging by the number of transactions it has each day
                on. Higher transaction count means the coin is being increasingly
                used, and since Metcalfe's Law proposes that more information being exchanged in a network means the
                network itself should be worth more, it also means the coin should
                increase in price. This was calculated as "how much Monero should be worth if it was a part of Bitcoin's
                network?" The answear is that Monero should be worth as much
                as its transactions represent as a percentage of Bitcoin's own transactions, but considering both coins'
                supplies. The formula is XMR-Supply*XMR-Tx/(BTC-Tx*BTC-Supply);
                {% endblocktrans %}
                <br>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">{% trans "Close" %}</button>
            </div>
        </div>
    </div>
</div>
<!-- Fim do Modal -->

<!-- Page level plugins -->
<script> 
    var data3 = {
        type: "scatter",
        mode: "lines",
        name: '{% trans "Fair price (XMR-Tx/BTC-Tx)" %}',
        x: {{ dates|safe }},
        y: {{ metcalfe|safe }},
        line: {
            color: '#dd1d1d'
            ,width: 1
        }
    };
    
    var data3_mobile = {
        type: "scatter",
        mode: "lines",
        name: '{% trans "Fair price (XMR-Tx/BTC-Tx)" %}',
        x: {{ dates|safe }},
        y: {{ metcalfe|safe }},
        line: {
            color: '#dd1d1d'
            ,width: 1
        }
    };
    var data4 = {
    type: "scatter",
    mode: "markers",
    name: '{% trans "Average price on date" %}',
    x: {{ dates|safe }},
    y: {{ prices|safe }},
    line: {color: '#7f421d'},
    marker: {
        color: {{ color|safe }},
        colorbar: {
            title: {
                text: '{% trans "Cycle on the Bitcoin pair (%)" %}',
                side: 'right'
                ,font: {
                    color: 'white'
                    ,size: 14
                }
            }
            ,thickness: 10
            ,tickfont: {
                color: 'white'
                ,size: 14
            }
            ,borderwidth: 0
        }, 
        colorscale: [['0', '#0000ff'], ['0.33', '#00ff00'], ['0.66', '#ffff00'], ['1', '#ff0000']], 
        sizemode: 'area',
        size: 5,
        cmax: 100,
        cmin: 0
    }
};

var data4_mobile = {
    type: "scatter",
    mode: "markers",
    name: '{% trans "Average price on date" %}',
    x: {{ dates|safe }},
    y: {{ prices|safe }},
    line: {color: '#7f421d'},
    marker: {
        color: {{ color|safe }},
        colorbar: {
            thickness: 4
            ,tickfont: {
                color: 'white'
                ,size: 6
            }
            ,borderwidth: 0
        }, 
        colorscale: [['0', '#0000ff'], ['0.33', '#00ff00'], ['0.66', '#ffff00'], ['1', '#ff0000']], 
        sizemode: 'area',
        size: 3,
        cmax: 100,
        cmin: 0
    }
};

    var data = [data3, data4];
    var data_mobile = [data3_mobile, data4_mobile];

    var layout = {
        plot_bgcolor:"#252221",
        paper_bgcolor:"#252221",
        annotations: [
        {
            xref: 'paper',
            yref: 'paper',
            x: 0.50,
            xanchor: 'auto',
            y: 0.02,
            yanchor: 'auto',
            text: 'Moneroj',
            showarrow: false,
            borderwidth: 1,
            bordercolor: '#5f5f5f',
            bgcolor: '#333333',
            borderpad: 5,
            align: 'center',
            font: {
            color: "white",
            size: 12
            }
        }],
        separators: ",.",
        legend: {
            x: 0.98, 
            y: 0.02, 
            bgcolor: '#333333', 
            bordercolor: '#5f5f5f', 
            borderwidth: 1, 
            font: {
                color: 'white', 
                size: 12
            }, 
            traceorder: 'normal', 
            xanchor: 'auto', 
            yanchor: 'auto'
        },
        hoverlabel: {
            namelength: -1
        },
        yaxis: {
            type: "log",
            title: {
                text: '{% trans "Price (BTC)" %}',
                font: {
                    size: 20,
                    color: 'white'
                }
            },
            tickformat :",.4f"
            ,nticks: 8
            ,tickfont: {
                color: "#ffffff"
                ,size: 12
            }
            ,gridcolor: "#333333"
        },
        xaxis: {
            hoverformat: "%Y-%m-%d",
            showgrid: true,
            type: 'date',
            nticks: 10
            ,tickfont: {
                color: "#dddddd"
                ,size: 13
            }
            ,gridcolor: "#333333"
            ,zeroline: true
        },
        margin: {
            l: 100,
            r: 50,
            b: 50,
            t: 20,
            pad: 10
        }
    };
    
    var layout_mobile = {
        plot_bgcolor:"black",
        paper_bgcolor:"black",
        separators: ",.",
        hoverlabel: {
            namelength: -1
        },
        legend: {
            x: 0.98, 
            y: 0.05, 
            bgcolor: '#000000', 
            bordercolor: '#5f5f5f', 
            borderwidth: 1, 
            font: {
                color: 'white', 
                size: 5
            }, 
            traceorder: 'normal', 
            xanchor: 'auto', 
            yanchor: 'auto'
        },
        showlegend: false,
        yaxis: {
            type: "log",
            tickformat :",.4f"
            ,nticks: 5
            ,tickfont: {
                color: "#ffffff"
                ,size: 7
            }
            ,gridcolor: "#444444"
        },
        xaxis: {
            hoverformat: "%Y",
            showgrid: true,
            type: 'date',
            nticks: 10
            ,tickfont: {
                color: "#dddddd"
                ,size: 7
            }
            ,gridcolor: "#444444"
            ,zeroline: true
        },
        margin: {
            l: 100,
            r: 50,
            b: 50,
            t: 20,
            pad: 10
        }
    };

    function findBootstrapEnvironment() {
        let envs = ['xs', 'sm', 'md', 'lg', 'xl'];

        let el = document.createElement('div');
        document.body.appendChild(el);

        let curEnv = envs.shift();

        for (let env of envs.reverse()) {
            el.classList.add(`d-${env}-none`);

            if (window.getComputedStyle(el).display === 'none') {
                curEnv = env;
                break;
            }
        }

        document.body.removeChild(el);
        return curEnv;

    }
    env_size = findBootstrapEnvironment();
    if (env_size == "xs") {
        Plotly.newPlot('graph', data_mobile, layout_mobile, {responsive: true, modeBarButtonsToRemove: ['toImage', 'hoverCompareCartesian', 'hoverClosest2d', 'toggleSpikelines', 'lasso2d', 'select2d', 'hoverClosestCartesian'], displaylogo: false});
    }
    else {
        Plotly.newPlot('graph', data, layout, {responsive: true, modeBarButtonsToRemove: ['toImage', 'hoverCompareCartesian', 'hoverClosest2d', 'toggleSpikelines', 'lasso2d', 'select2d', 'hoverClosestCartesian'], displaylogo: false});
    }
</script>

{% endblock %}
